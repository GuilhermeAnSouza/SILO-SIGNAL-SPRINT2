"
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silo Tech | Dashboard</title>
    <link rel="icon" href="./assets/favicon.png" type="image/png">
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="
kpis_silo1(),
kpis_silo2()">

    <div class="conteudo-geral">

        <div class="container-menu">

            <div class="menu-lateral">
                <div id="menu-titulo"><img src="assets/logo4.jpg"></div>
                <div class="menu-opcoes">
                    <img src="assets/house.png" onclick="mostrarGeral()">
                    <img src="assets/chart-line.png" onclick="mostrarIndividual()">
                    <img src="assets/gear.png" onclick="mostrarConfig()">
                </div>
                <a id="menu-sair" href="../index.html"><img src="assets/sign-out.png"></a>
            </div>

        </div>

        <div class="container-conteudo">

            <div id="container-titulo">Bem-vindo(a), <span id="b_usuario">usuário</span>!</div>
            <!-- Usuário tem que ser dinâmico -->

            <div id="subTitulo">Visão Geral</div>

            <script data-jsd-embedded data-key="2d0b87df-7d61-4e46-ab2b-d49f73d8cc5f"
                data-base-url="https://jsd-widget.atlassian.com"
                src="https://jsd-widget.atlassian.com/assets/embed.js"></script>

            <div id="visaoGeral">

                <div id="container-kpiGeral">
                    <div class="kpi1">
                        <p>STATUS ATUAL</p>
                        <p class="nome-silo">SILO 1</p>
                        <div id="porcentagem_silo1_geral" class="porcentagem-silo">
                            <!-- <div id="statusSilo1"></div>
                            <span id="silo1_porcentagem">1.56%</span> -->
                            <!-- esse dado precisa ser dinamico -->
                        </div>
                    </div>

                    <div class="kpi2">
                        <p>STATUS ATUAL</p>
                        <p class="nome-silo">SILO 2</p>
                        <div id="porcentagem_silo2_geral" class="porcentagem-silo">
                            <!-- <div id="statusSilo2"></div>
                            <span id="silo2_porcentagem">2.89%</span> -->
                            <!-- esse dado precisa ser dinamico -->
                        </div>
                    </div>


                </div>

                <div class="kpi-bandeira">
                    <h3>Legenda</h3>
                    <div class="legenda-status">
                        <div class="legenda-ok">
                            <div id="status-ok"></div><span>OK: 0% - 4%</span>
                        </div>
                        <div class="legenda-atencao">
                            <div id="status-atencao"></div><span>Atenção: 5% - 9%</span>
                        </div>
                        <div class="legenda-alerta">
                            <div id="status-alerta"></div><span>Alerta: 10% - 15%</span>
                        </div>
                    </div>
                </div>

            </div>

            <div id="visaoIndividual">

                <div class="input_select_silo">
                    <select id="select_silo" onclick="selecionarSilo()">
                        <option value="1">SILO 1</option>
                        <option value="2">SILO 2</option>
                    </select>
                    <div id="divMensagem"></div>
                </div>

                <!-- Dash Silo1 -->
                <div id="dashboard-Silo1-ind">

                    <div id="container-kpi-ind">
                        <div class="mini-container">

                            <div class="kpi1">
                                <p>STATUS ATUAL</p>
                                <p class="nome-silo">SILO 1</p>
                                <div id="porcentagem_silo1_ind" class="porcentagem-silo">
                                    <!-- <div id="statusSilo1"></div> -->
                                    <!-- <span id="silo1_porcentagem">2.89%</span> esse dado precisa ser dinamico -->
                                </div>
                            </div>

                            <div id="tendencia-silo">
                                <p>Tendencia de aumento para o proximo mês</p>
                                <p id="porcentagem-tendencia-silo">XP.TO%</p>
                            </div>

                        </div>

                        <div class="grafico-geral" id="grafico-hora">
                            <canvas id="silo1_meiaHora"></canvas>
                        </div>

                    </div>

                    <div class="grafico-longo-prazo">
                        <div class="grafico-geral">
                            <canvas id="silo1_dia"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="silo1_semana"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="silo1_semestre"></canvas>
                        </div>
                    </div>


                </div>

                <!-- Dash Silo 2 -->
                <div id="dashboard-Silo2-ind">

                    <div id="container-kpi-ind">
                        <div class="mini-container">

                            <div class="kpi2">
                                <p>STATUS ATUAL</p>
                                <p class="nome-silo">SILO 2</p>
                                <div id="porcentagem_silo2_ind" class="porcentagem-silo">
                                    <!-- <div id="statusSilo2"></div>
                                    <span id="silo2_porcentagem">2.89%</span> esse dado precisa ser dinamico -->
                                </div>
                            </div>

                            <div id="tendencia-silo">
                                <p>Tendencia de aumento para o proximo mês</p>
                                <p id="porcentagem-tendencia-silo">XP.TO%</p>
                            </div>

                        </div>

                        <div class="grafico-geral" id="grafico-hora">
                            <canvas id="silo2_meiaHora"></canvas>
                        </div>

                    </div>

                    <div class="grafico-longo-prazo">
                        <div class="grafico-geral">
                            <canvas id="silo2_dia"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="silo2_semana"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="silo2_semestre"></canvas>
                        </div>
                    </div>


                </div>

                <div class="kpi-bandeira-ind">
                    <h3>Legenda</h3>
                    <div class="legenda-status">
                        <div class="legenda-ok">
                            <div id="status-ok"></div><span>OK: 0% - 4%</span>
                        </div>
                        <div class="legenda-atencao">
                            <div id="status-atencao"></div><span>Atenção: 5% - 9%</span>
                        </div>
                        <div class="legenda-alerta">
                            <div id="status-alerta"></div><span>Alerta: 10% - 15%</span>
                        </div>
                    </div>
                </div>


            </div>

            <div id="validar_config" class="validar-config">
                <div class="container-validar-config">
                    <div class="conteudo-validar-config">
                        <div class="titulo-validar-config">
                            <h3>
                                Digite o código de ativação da sua empresa para acessar as configurações
                            </h3>
                        </div>
                        <div class="form-validar-config">
                            <input type="text" id="codigoValidarConfig_input">
                            <button onclick="validar_codigo()">Validar código</button>
                            <div id="erro_validar_config"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="visaoConfig">

                <div class="inserir-usuario">

                    <h3>Adicionar novos usuários</h3>

                    <div class="inserir-usuario-form">

                        <label for="codigoAtivacaoUsuario_input">
                            <p>Código ativação*:</p>
                            <input type="email" id="codigoAtivacaoUsuario_input" class="input" name="iptCodAtvEmpresa">
                        </label>

                        <label for="nome_input">
                            <p>Nome*: </p>
                            <input type="text" id="nome_input" name="iptName" class="input">
                        </label>

                        <label for="telUsuario_input">
                            <p>Telefone Comercial*: </p>
                            <input type="number" id="telUsuario_input" class="input" name="telComercial">
                        </label>

                        <label for="emailUsuario_input">
                            <p>Email Pessoal*: </p>
                            <input type="email" id="emailUsuario_input" class="input" name="iptEmail">
                        </label>

                        <label for="iptPassword">
                            <p>Senha*: </p>
                            <input type="password" id="senha_input" name="iptPassword">
                        </label>
                        <label for="ipt_confirmPassword">
                            <p>Confirme a senha*: </p>
                            <input type="password" id="confirmaSenha_input" name="ipt_confirmPassword">
                        </label>

                        <div class="container-button">
                            <button type="submit" id="button_cadastro" onclick="cadastrarUsuario()">Cadastrar</button>
                        </div>

                    </div>

                </div>

                <div class="mostrar-usuario">
                    <div class="container-mostrar-usuario">
                        <div class="titulo-usuarios-inseridos">
                            <h3>Usuários Adicionados</h3>
                        </div>
                        <div id="usuarios_inseridos" class="usuarios-inseridos">
                        </div>
                    </div>
                </div>

            </div>


        </div>

    </div>
</body>

</html>

<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    document.getElementById('visaoGeral').style.display = 'flex';
    //funcoes para aparecer e desaparecer cada div
    function mostrarGeral() {
        document.getElementById('visaoGeral').style.display = 'flex';
        document.getElementById('visaoIndividual').style.display = 'none';
        document.getElementById('validar_config').style.display = 'none'
        document.getElementById('visaoConfig').style.display = 'none';
        subTitulo.innerHTML = `Visão Geral`;
    }

    function mostrarIndividual() {
        document.getElementById('visaoGeral').style.display = 'none'
        document.getElementById('visaoIndividual').style.display = 'flex'
        document.getElementById('validar_config').style.display = 'none'
        document.getElementById('visaoConfig').style.display = 'none'
        document.getElementById('dashboard-Silo1-ind').style.display = 'block'
        subTitulo.innerHTML = `DashBoard Individual`;
    }

    function mostrarConfig() {
        document.getElementById('visaoGeral').style.display = 'none'
        document.getElementById('visaoIndividual').style.display = 'none'
        document.getElementById('validar_config').style.display = 'flex'
        document.getElementById('visaoConfig').style.display = 'none'
        subTitulo.innerHTML = `Configurações`;

    }

    function validar_codigo() {
        var codigoVar = codigoValidarConfig_input.value;

        var codigo_validacao = 123

        if (codigoVar == codigo_validacao) {
            document.getElementById('visaoGeral').style.display = 'none'
            document.getElementById('visaoIndividual').style.display = 'none'
            document.getElementById('validar_config').style.display = 'none'
            document.getElementById('visaoConfig').style.display = 'flex'
            subTitulo.innerHTML = `Configurações`;
        } else {
            erro_validar_config.innerHTML = `Acesso negado. Código inválido`
        }
    }

    // -------- FUNÇÕES DASH DINÂMICA --------------------------------------------------------------------------------------------------- //
    // GRÁFICO DE LINHA A CADA MEIA HORA (SILO 1 E SILO 2)
    function selecionarSilo() {
        const seletor = document.getElementById("select_silo");
        const siloId = seletor.value;
        atualizarPeriodicamente(siloId);

        if (siloId == '1') {
            divMensagem.innerHTML = 'Silo 1 selecionado com sucesso!'
            document.getElementById('dashboard-Silo1-ind').style.display = 'block'
            document.getElementById('dashboard-Silo2-ind').style.display = 'none'
        } else if (siloId == '2') {
            divMensagem.innerHTML = 'Silo 2 selecionado com sucesso!'
            document.getElementById('dashboard-Silo1-ind').style.display = 'none'
            document.getElementById('dashboard-Silo2-ind').style.display = 'block'
        }
    }

    function atualizarPeriodicamente(siloId) {
        buscarDadosSilo1MeiaHora(siloId);
        buscarDadosSiloSemana(siloId);
        buscarDadosSiloSemestral(siloId);

        setTimeout(() => {
            buscarDadosSilo1MeiaHora(siloId);
        }, 30 * 60 * 1000); // 30 minutos em milissegundos

        setTimeout(() => {
            buscarDadosSiloSemana(siloId);
        }, 1.000 * 120 * 24 * 7); // 604.800.000 milhoes milissegundos - 7 dias

        setTimeout(() => {
            buscarDadosSiloSemestral(siloId);
        }, 15780096 * 1000); // 6 meses em milissegundos
    }


    function buscarDadosSilo1MeiaHora(siloId) {
        // Faz a requisição para a API
        fetch(`/dashboard/buscarMedidasMeiaHora/${siloId}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (dados) {
                        console.log(`Dados recebidos para Silo ${siloId}: ${JSON.stringify(dados)}`);

                        dados.reverse();

                        plotarGraficoMeiaHora(dados, siloId);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para Silo ${siloId}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para o gráfico do Silo ${siloId}: ${error.message}`);
            });
    }

    function plotarGraficoMeiaHora(dados, siloId) {
        const labels = dados.map(dado => dado.dataHora);
        const porcentagem = dados.map(dado => dado.porcentagem);

        const ctx = document.getElementById(`silo${siloId}_meiaHora`).getContext('2d');

        if (window[`graficoSiloMeiaHora${siloId}`]) {
            window[`graficoSiloMeiaHora${siloId}`].data.labels = labels;
            window[`graficoSiloMeiaHora${siloId}`].data.datasets[0].data = porcentagem;
            window[`graficoSiloMeiaHora${siloId}`].update();
        } else {
            window[`graficoSiloMeiaHora${siloId}`] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Maior % diária dos últimos 7 dias`,
                        data: porcentagem, 
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)', 
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Tempo'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Porcentagem (%)'
                            },
                            beginAtZero: true,
                            suggestedMax: 15, 
                        }
                    }
                }
            });
        }
    }

    function buscarDadosSiloSemana(siloId) {
        fetch(`/dashboard/buscarDadosSiloSemana/${siloId}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (dados) {
                        console.log(`Dados recebidos para Silo ${siloId}: ${JSON.stringify(dados)}`);

                        dados.reverse();

                        plotarGraficoSemana(dados, siloId);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para Silo ${siloId}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para o gráfico do Silo ${siloId}: ${error.message}`);
            });
    }

    function plotarGraficoSemana(dados, siloId) {
        const labels = dados.map(dado => dado.dataHora);
        const porcentagem = dados.map(dado => dado.porcentagem);

        const ctx = document.getElementById(`silo${siloId}_semana`).getContext('2d');

        if (window[`graficoSiloSemana${siloId}`]) {
            window[`graficoSiloSemana${siloId}`].data.labels = labels;
            window[`graficoSiloSemana${siloId}`].data.datasets[0].data = porcentagem;
            window[`graficoSiloSemana${siloId}`].update();
        } else {
            window[`graficoSiloSemana${siloId}`] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Maior % diária dos últimos 7 dias`,
                        data: porcentagem,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: ''
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Porcentagem (%)'
                            },
                            beginAtZero: true,
                            suggestedMax: 15, 
                        }
                    }
                }
            });
        }
    }


    function buscarDadosSiloSemestral(siloId) {
        fetch(`/dashboard/buscarDadosSiloSemestral/${siloId}`, { cache: 'no-store' })
        .then(function (response) {
                if (response.ok) {
                    response.json().then(function (dados) {
                        console.log(`Dados recebidos para Silo ${siloId}: ${JSON.stringify(dados)}`);

                        dados.reverse();

                        plotarGraficoSemestral(dados, siloId);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para Silo ${siloId}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para o gráfico do Silo ${siloId}: ${error.message}`);
            });
    }

    function plotarGraficoSemestral(dados, siloId) {
        const labels = dados.map(dado => dado.dataHora);
        const porcentagem = dados.map(dado => dado.porcentagem);

        const ctx = document.getElementById(`silo${siloId}_semestre`).getContext('2d');

        if (window[`graficoSiloSemestral${siloId}`]) {
            window[`graficoSiloSemestral${siloId}`].data.labels = labels;
            window[`graficoSiloSemestral${siloId}`].data.datasets[0].data = porcentagem;
            window[`graficoSiloSemestral${siloId}`].update();
        } else {
            window[`graficoSiloSemestral${siloId}`] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Maior % mensal dos últimos 6 meses`,
                        data: porcentagem,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: ''
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Porcentagem (%)'
                            },
                            beginAtZero: true,
                            suggestedMax: 15, 
                        }
                    }
                }
            });
        }
    }


</script>