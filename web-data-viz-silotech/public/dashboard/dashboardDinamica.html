<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silo Tech | Dashboard</title>
    <link rel="icon" href="./assets/favicon.png" type="image/png">
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="listarUsuario()">

    <div class="conteudo-geral">

        <div class="container-menu">

            <div class="menu-lateral">
                <div id="menu-titulo"><img src="assets/logo4.jpg"></div>
                <div class="menu-opcoes">
                    <img src="assets/house.png" onclick="mostrarGeral()">
                    <img src="assets/chart-line.png" onclick="mostrarIndividual()">
                    <img src="assets/gear.png" onclick="mostrarConfig()">
                </div>
                <a id="menu-sair" href="../index.html"><img src="assets/sign-out.png"></a>
            </div>

        </div>

        <div class="container-conteudo">

            <div id="container-titulo">Bem-vindo(a), <span id="b_usuario">usuário</span>!</div>
            <!-- Usuário tem que ser dinâmico -->

            <div id="subTitulo">Visão Geral</div>

            <script data-jsd-embedded data-key="2d0b87df-7d61-4e46-ab2b-d49f73d8cc5f"
                data-base-url="https://jsd-widget.atlassian.com"
                src="https://jsd-widget.atlassian.com/assets/embed.js"></script>

            <div id="visaoGeral">

                <div id="container-kpiGeral">
                    <div class="kpi1">
                        <p>STATUS ATUAL</p>
                        <p class="nome-silo">SILO 1</p>
                        <div class="porcentagem-silo">
                            <div id="statusSilo1"></div>
                            <span id="silo1_porcentagem">1.56%</span>
                            <!-- esse dado precisa ser dinamico -->
                        </div>
                    </div>

                    <div class="kpi2">
                        <p>STATUS ATUAL</p>
                        <p class="nome-silo">SILO 2</p>
                        <div class="porcentagem-silo">
                            <div id="statusSilo2"></div>
                            <span id="silo2_porcentagem">2.89%</span>
                            <!-- esse dado precisa ser dinamico -->
                        </div>
                    </div>


                </div>

                <div class="kpi-bandeira">
                    <h3>Legenda</h3>
                    <div class="legenda-status">
                        <div class="legenda-ok">
                            <div id="status-ok"></div><span>OK: 0% - 4%</span>
                        </div>
                        <div class="legenda-atencao">
                            <div id="status-atencao"></div><span>Atenção: 5% - 9%</span>
                        </div>
                        <div class="legenda-alerta">
                            <div id="status-alerta"></div><span>Alerta: 10% - 15%</span>
                        </div>
                    </div>
                </div>

            </div>

            <div id="visaoIndividual">

                <div class="input_select_silo">
                    <select id="select_silo" onclick="selecionarSilo()">
                        <option value="silo1">SILO 1</option>
                        <option value="silo2">SILO 2</option>
                    </select>
                    <div id="divMensagem"></div>
                </div>

                <!-- Dash Silo1 -->
                <div id="dashboard-Silo1-ind">

                    <div id="container-kpi-ind">
                        <div class="mini-container">

                            <div class="kpi1">
                                <p>STATUS ATUAL</p>
                                <p class="nome-silo">SILO 1</p>
                                <div class="porcentagem-silo">
                                    <div id="statusSilo1"></div>
                                    <span id="silo1_porcentagem">2.89%</span> <!--esse dado precisa ser dinamico-->
                                </div>
                            </div>

                            <div id="tendencia-silo">
                                <p>Tendencia de aumento para o proximo mês</p>
                                <p id="porcentagem-tendencia-silo">XP.TO%</p>
                            </div>

                        </div>

                        <div class="grafico-geral" id="grafico-hora">
                            <canvas id="Silo1_meiaHora"></canvas>
                        </div>

                    </div>

                    <div class="grafico-longo-prazo">
                        <div class="grafico-geral">
                            <canvas id="Silo1_Dia"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="Silo1_Semana"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="Silo1_Semestre"></canvas>
                        </div>
                    </div>


                </div>

                <!-- Dash Silo 2 -->
                <div id="dashboard-Silo2-ind">

                    <div id="container-kpi-ind">
                        <div class="mini-container">

                            <div class="kpi2">
                                <p>STATUS ATUAL</p>
                                <p class="nome-silo">SILO 2</p>
                                <div class="porcentagem-silo">
                                    <div id="statusSilo2"></div>
                                    <span id="silo2_porcentagem">2.89%</span> <!--esse dado precisa ser dinamico-->
                                </div>
                            </div>

                            <div id="tendencia-silo">
                                <p>Tendencia de aumento para o proximo mês</p>
                                <p id="porcentagem-tendencia-silo">XP.TO%</p>
                            </div>

                        </div>

                        <div class="grafico-geral" id="grafico-hora">
                            <canvas id="Silo2_meiaHora"></canvas>
                        </div>

                    </div>

                    <div class="grafico-longo-prazo">
                        <div class="grafico-geral">
                            <canvas id="Silo2_Dia"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="Silo2_Semana"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="Silo2_Semestre"></canvas>
                        </div>
                    </div>


                </div>

                <div class="kpi-bandeira-ind">
                    <h3>Legenda</h3>
                    <div class="legenda-status">
                        <div class="legenda-ok">
                            <div id="status-ok"></div><span>OK: 0% - 4%</span>
                        </div>
                        <div class="legenda-atencao">
                            <div id="status-atencao"></div><span>Atenção: 5% - 9%</span>
                        </div>
                        <div class="legenda-alerta">
                            <div id="status-alerta"></div><span>Alerta: 10% - 15%</span>
                        </div>
                    </div>
                </div>


            </div>

            <div id="validar_config" class="validar-config">
                <div class="container-validar-config">
                    <div class="conteudo-validar-config">
                        <div class="titulo-validar-config">
                            <h3>
                                Digite o código de ativação da sua empresa para acessar as configurações
                            </h3>
                        </div>
                        <div class="form-validar-config">
                            <input type="text" id="codigoValidarConfig_input">
                            <button onclick="validar_codigo()">Validar código</button>
                            <div id="erro_validar_config"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="visaoConfig">

                <div class="inserir-usuario">

                    <h3>Adicionar novos usuários</h3>

                    <div class="inserir-usuario-form">

                        <label for="codigoAtivacaoUsuario_input">
                            <p>Código ativação*:</p>
                            <input type="email" id="codigoAtivacaoUsuario_input" class="input" name="iptCodAtvEmpresa">
                        </label>

                        <label for="nome_input">
                            <p>Nome*: </p>
                            <input type="text" id="nome_input" name="iptName" class="input">
                        </label>

                        <label for="telUsuario_input">
                            <p>Telefone Comercial*: </p>
                            <input type="number" id="telUsuario_input" class="input" name="telComercial">
                        </label>

                        <label for="emailUsuario_input">
                            <p>Email Pessoal*: </p>
                            <input type="email" id="emailUsuario_input" class="input" name="iptEmail">
                        </label>

                        <label for="iptPassword">
                            <p>Senha*: </p>
                            <input type="password" id="senha_input" name="iptPassword">
                        </label>
                        <label for="ipt_confirmPassword">
                            <p>Confirme a senha*: </p>
                            <input type="password" id="confirmaSenha_input" name="ipt_confirmPassword">
                        </label>

                        <div class="container-button">
                            <button type="submit" id="button_cadastro" onclick="cadastrarUsuario()">Cadastrar</button>
                        </div>

                    </div>

                </div>

                <div class="mostrar-usuario">
                    <div class="container-mostrar-usuario">
                        <div class="titulo-usuarios-inseridos">
                            <h3>Usuários Adicionados</h3>
                        </div>
                        <div id="usuarios_inseridos" class="usuarios-inseridos">
                        </div>
                    </div>
                </div>

            </div>


        </div>

    </div>
</body>

</html>

<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    document.getElementById('visaoGeral').style.display = 'flex';
    //funcoes para aparecer e desaparecer cada div
    function mostrarGeral() {
        document.getElementById('visaoGeral').style.display = 'flex';
        document.getElementById('visaoIndividual').style.display = 'none';
        document.getElementById('validar_config').style.display = 'none'
        document.getElementById('visaoConfig').style.display = 'none';
        subTitulo.innerHTML = `Visão Geral`;
    }

    function mostrarIndividual() {
        document.getElementById('visaoGeral').style.display = 'none'
        document.getElementById('visaoIndividual').style.display = 'flex'
        document.getElementById('validar_config').style.display = 'none'
        document.getElementById('visaoConfig').style.display = 'none'
        document.getElementById('dashboard-Silo1-ind').style.display = 'block'
        subTitulo.innerHTML = `DashBoard Individual`;
    }

    function selecionarSilo() {
        var siloSelecionado = select_silo.value;
        if (siloSelecionado == 'silo1') {
            divMensagem.innerHTML = 'Silo 1 selecionado com sucesso!'
            document.getElementById('dashboard-Silo1-ind').style.display = 'block'
            document.getElementById('dashboard-Silo2-ind').style.display = 'none'
        } else if (siloSelecionado == 'silo2') {
            divMensagem.innerHTML = 'Silo 2 selecionado com sucesso!'
            document.getElementById('dashboard-Silo1-ind').style.display = 'none'
            document.getElementById('dashboard-Silo2-ind').style.display = 'block'
        }
    }

    function mostrarConfig() {
        document.getElementById('visaoGeral').style.display = 'none'
        document.getElementById('visaoIndividual').style.display = 'none'
        document.getElementById('validar_config').style.display = 'flex'
        document.getElementById('visaoConfig').style.display = 'none'
        subTitulo.innerHTML = `Configurações`;

    }

    function validar_codigo() {
        var codigoVar = codigoValidarConfig_input.value;

        var codigo_validacao = 123

        if (codigoVar == codigo_validacao) {
            document.getElementById('visaoGeral').style.display = 'none'
            document.getElementById('visaoIndividual').style.display = 'none'
            document.getElementById('validar_config').style.display = 'none'
            document.getElementById('visaoConfig').style.display = 'flex'
            subTitulo.innerHTML = `Configurações`;
        } else {
            erro_validar_config.innerHTML = `Acesso negado. Código inválido`
        }
    }

    function cadastrarUsuario() {
        var nomeVar = nome_input.value;
        var telUsuarioVar = telUsuario_input.value;
        var emailUsuarioVar = emailUsuario_input.value;
        var senhaVar = senha_input.value;
        var confirmacaoSenhaVar = confirmaSenha_input.value;
        var codigoVar = codigoAtivacaoUsuario_input.value;

        if (
            nomeVar == "" ||
            telUsuarioVar == "" ||
            emailUsuarioVar == "" ||
            senhaVar == "" ||
            confirmacaoSenhaVar == "" ||
            codigoVar == ""
        ) {
            alert("Preencha todos os campos!")
        } else {
            usuarios_inseridos.innerHTML += `<p>
                            Nome: ${nomeVar} | 
                            Email Pessoal: ${emailUsuarioVar} | 
                            Telefone Comercial: ${telUsuarioVar} | 
                            </p>`
        }


    }

    function listarUsuario() {
        var idEmpresa = sessionStorage.FK_EMPRESA;

        fetch(`/usuarios/listarUsuario/${idEmpresa}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var conteudo = document.getElementById("usuarios_inseridos");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    conteudo.appendChild(mensagem);
                    throw "Nenhum resultado encontrado.";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var conteudo = document.getElementById("usuarios_inseridos");
                    conteudo.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var lista = resposta[i];

                        usuarios_inseridos.innerHTML += `<p>
                            Nome: ${lista.nome} | 
                            Email Pessoal: ${lista.email} | 
                            Telefone Comercial: ${lista.telComercial} | 
                            </p>`
                    }

                   
                })}

        }

        )
    }

    //grafico de linha silo 1 

    const Silo1_meiaHora = document.getElementById('Silo1_meiaHora');

    new Chart(Silo1_meiaHora, {
        type: 'line',
        data: {
            //aqui devem ir os periodos de tempo (30min em 30min)

            labels: ['10:30', '11:00', '11:30', '12:00', '12:30'],

            datasets: [{
                label: 'Silo 1',
                //valores que devem vir do sensor
                data: [0.12, 0.19, 0.37, 0.55, 1.27],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: 'rgb(255, 255, 255)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        boxWidth: 20,
                        padding: 15
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                },
                x: {
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                }
            }
        }
    });


    const Silo1_Dia = document.getElementById('Silo1_Dia');

    new Chart(Silo1_Dia, {
        type: 'bar',
        data: {
            //aqui devem ir os periodos de tempo (diariamente)

            labels: ['10:30', '11:00', '11:30', '12:00', '12:30'],

            datasets: [{
                label: 'Silo 1',
                //valores que devem vir do sensor
                data: [0.12, 0.19, 0.37, 0.55, 1.27],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: 'rgb(255, 255, 255)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        boxWidth: 20,
                        padding: 15
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                },
                x: {
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                }
            }
        }
    });

    const Silo1_Semana = document.getElementById('Silo1_Semana');

    new Chart(Silo1_Semana, {
        type: 'bar',
        data: {
            //aqui devem ir os periodos de tempo (Semanalmente)

            labels: ['10:30', '11:00', '11:30', '12:00', '12:30'],

            datasets: [{
                label: 'Silo 1',
                //valores que devem vir do sensor
                data: [0.12, 0.19, 0.37, 0.55, 1.27],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: 'rgb(255, 255, 255)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        boxWidth: 20,
                        padding: 15
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                },
                x: {
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                }
            }
        }
    });

    const Silo1_Semestre = document.getElementById('Silo1_Semestre');

    new Chart(Silo1_Semestre, {
        type: 'bar',
        data: {
            //aqui devem ir os periodos de tempo (semestralmente)

            labels: ['10:30', '11:00', '11:30', '12:00', '12:30'],

            datasets: [{
                label: 'Silo 1',
                //valores que devem vir do sensor
                data: [0.12, 0.19, 0.37, 0.55, 1.27],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: 'rgb(255, 255, 255)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        boxWidth: 20,
                        padding: 15
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                },
                x: {
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                }
            }
        }
    });

    //grafico de linha silo 2

    const Silo2_meiaHora = document.getElementById('Silo2_meiaHora');

    new Chart(Silo2_meiaHora, {
        type: 'line',
        data: {
            //aqui devem ir os periodos de tempo (30min em 30min)

            labels: ['10:30', '11:00', '11:30', '12:00', '12:30'],

            datasets: [{
                label: 'Silo 2',
                //valores que devem vir do sensor
                data: [0.12, 0.19, 0.37, 0.55, 1.27],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: 'rgb(255, 255, 255)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        boxWidth: 20,
                        padding: 15
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                },
                x: {
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                }
            }
        }
    });

    const Silo2_Dia = document.getElementById('Silo2_Dia');

    new Chart(Silo2_Dia, {
        type: 'bar',
        data: {
            //aqui devem ir os periodos de tempo (diariamente)

            labels: ['10:30', '11:00', '11:30', '12:00', '12:30'],

            datasets: [{
                label: 'Silo 2',
                //valores que devem vir do sensor
                data: [0.12, 0.19, 0.37, 0.55, 1.27],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: 'rgb(255, 255, 255)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        boxWidth: 20,
                        padding: 15
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                },
                x: {
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                }
            }
        }
    });

    const Silo2_Semana = document.getElementById('Silo2_Semana');

    new Chart(Silo2_Semana, {
        type: 'bar',
        data: {
            //aqui devem ir os periodos de tempo (Semanalmente)

            labels: ['10:30', '11:00', '11:30', '12:00', '12:30'],

            datasets: [{
                label: 'Silo 2',
                //valores que devem vir do sensor
                data: [0.12, 0.19, 0.37, 0.55, 1.27],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: 'rgb(255, 255, 255)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        boxWidth: 20,
                        padding: 15
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                },
                x: {
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                }
            }
        }
    });

    const Silo2_Semestre = document.getElementById('Silo2_Semestre');

    new Chart(Silo2_Semestre, {
        type: 'bar',
        data: {
            //aqui devem ir os periodos de tempo (semestralmente)

            labels: ['10:30', '11:00', '11:30', '12:00', '12:30'],

            datasets: [{
                label: 'Silo 2',
                //valores que devem vir do sensor
                data: [0.12, 0.19, 0.37, 0.55, 1.27],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: 'rgb(255, 255, 255)',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        boxWidth: 20,
                        padding: 15
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                },
                x: {
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        font: {
                            size: 16
                        },
                        color: 'rgb(255, 255, 255)'
                    }
                }
            }
        }
    });

</script>