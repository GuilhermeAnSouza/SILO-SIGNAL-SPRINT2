<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silo Tech | Dashboard</title>
    <link rel="icon" href="./assets/favicon.png" type="image/png">
    <link rel="stylesheet" href="dashboard.css">
    <!-- <link rel="stylesheet" href="../js/sessao.js"> -->
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="
listar(),
listarUsuario(),
kpis_silo2(),
alerta_silo1(),
alerta_silo2()">

    <div class="conteudo-geral">
        
        <div class="container-menu">

            <div class="menu-lateral">
                <div id="menu-titulo"><img src="assets/logo4.jpg"></div>
                <div class="menu-opcoes">
                    <img src="assets/house.png" onclick="mostrarGeral()">
                    <img src="assets/chart-line.png" onclick="mostrarIndividual()">
                    <img src="assets/gear.png" onclick="mostrarConfig()">
                </div>
                <a id="menu-sair" href="../index.html"><img src="assets/sign-out.png"></a>
            </div>

        </div>

        <div class="container-conteudo">

            <div id="container-titulo">Bem-vindo(a), <span id="b_usuario">usuário</span>!</div>
            <!-- Usuário tem que ser dinâmico -->

            <div id="subTitulo">Visão Geral</div>

            <script data-jsd-embedded data-key="2d0b87df-7d61-4e46-ab2b-d49f73d8cc5f"
                data-base-url="https://jsd-widget.atlassian.com"
                src="https://jsd-widget.atlassian.com/assets/embed.js"></script>

            <div id="visaoGeral">

                <div id="container-kpiGeral">
                    <div class="kpi1">
                        <p>STATUS ATUAL</p>
                        <p class="nome-silo">SILO 1</p>
                        <div id="porcentagem_silo1_geral" class="porcentagem-silo">
                            <!-- <div id="statusSilo1"></div>
                            <span id="silo1_porcentagem">1.56%</span> -->
                            <!-- esse dado precisa ser dinamico -->
                        </div>
                    </div>

                    <div class="kpi2">
                        <p>STATUS ATUAL</p>
                        <p class="nome-silo">SILO 2</p>
                        <div id="porcentagem_silo2_geral" class="porcentagem-silo">
                            <span id="silo2_porcentagem">INATIVO</span>
                        </div>
                    </div>


                </div>

                <div class="kpi-bandeira">
                    <h3>Legenda</h3>
                    <div class="legenda-status">
                        <div class="legenda-ok">
                            <div id="status-ok"></div><span>OK: 0% - 4.99%</span>
                        </div>
                        <div class="legenda-atencao">
                            <div id="status-atencao"></div><span>Atenção: 5% - 9.99%</span>
                        </div>
                        <div class="legenda-alerta">
                            <div id="status-alerta"></div><span>Alerta: A partir de 10%</span>
                        </div>
                    </div>
                </div>

            </div>

            <div id="visaoIndividual">

                <div class="input_select_silo">
                    <select id="select_silo" onclick="selecionarSilo()">
                        <option value="#">ESCOLHA SEU SILO</option>
                        <option value="1">SILO 1</option>
                        <option value="2">SILO 2</option>
                    </select>
                    <div id="divMensagem"></div>
                </div>

                <!-- ESCOLHA SILO -->
                <div id="escolha_silo">
                    <p>Escolha um silo para continuar.</p>
                </div>

                <!-- Dash Silo1 -->
                <div id="dashboard-Silo1-ind">

                    <div id="container-kpi-ind">
                        <div class="mini-container">

                            <div class="kpi1">
                                <p>STATUS ATUAL</p>
                                <p class="nome-silo">SILO 1</p>
                                <div id="porcentagem_silo1_ind" class="porcentagem-silo">
                                    <!-- <div id="statusSilo1"></div>
                                    <span id="silo1_porcentagem">2.89%</span> esse dado precisa ser dinamico -->
                                </div>
                            </div>

                        </div>

                        <div class="grafico-geral" id="grafico-hora">
                            <canvas id="silo1_meiaHora"></canvas>
                        </div>

                    </div>

                    <div class="grafico-longo-prazo">
                        <div class="grafico-geral">
                            <canvas id="silo1_6horas"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="silo1_semana"></canvas>
                        </div>
                        <div class="grafico-geral">
                            <canvas id="silo1_semestre"></canvas>
                        </div>
                    </div>


                </div>

                <!-- Dash Silo 2 -->
                <div id="dashboard-Silo2-ind">
                    <p>Silo INATIVO</p>
                </div>

                <div class="kpi-bandeira-ind">
                    <h3>Legenda</h3>
                    <div class="legenda-status">
                        <div class="legenda-ok">
                            <div id="status-ok"></div><span>OK: 0% - 4.99%</span>
                        </div>
                        <div class="legenda-atencao">
                            <div id="status-atencao"></div><span>Atenção: 5% - 9.99%</span>
                        </div>
                        <div class="legenda-alerta">
                            <div id="status-alerta"></div><span>Alerta: A partir de 10%</span>
                        </div>
                    </div>
                </div>


            </div>

            <div id="validar_config" class="validar-config">
                <div class="container-validar-config">
                    <div class="conteudo-validar-config">
                        <div class="titulo-validar-config">
                            <h3>
                                Digite o código de ativação da sua empresa para acessar as configurações
                            </h3>
                        </div>
                        <div class="form-validar-config">
                            <input type="text" id="codigoValidarConfig_input">
                            <button onclick="validar_codigo()">Validar código</button>
                            <div id="erro_validar_config"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="visaoConfig">

                <div class="inserir-usuario">

                    <h3>Adicionar novos usuários</h3>

                    <div class="inserir-usuario-form">

                        <label for="codigoAtivacaoUsuario_input">
                            <p>Código ativação*:</p>
                            <input type="email" id="codigoAtivacaoUsuario_input" class="input" name="iptCodAtvEmpresa">
                        </label>

                        <label for="nome_input">
                            <p>Nome*: </p>
                            <input type="text" id="nome_input" name="iptName" class="input">
                        </label>

                        <label for="telUsuario_input">
                            <p>Telefone Comercial*: </p>
                            <input type="number" id="telUsuario_input" class="input" name="telComercial">
                        </label>

                        <label for="emailUsuario_input">
                            <p>Email Pessoal*: </p>
                            <input type="email" id="emailUsuario_input" class="input" name="iptEmail">
                        </label>

                        <label for="iptPassword">
                            <p>Senha*: </p>
                            <input type="password" id="senha_input" name="iptPassword">
                        </label>
                        <label for="ipt_confirmPassword">
                            <p>Confirme a senha*: </p>
                            <input type="password" id="confirmaSenha_input" name="ipt_confirmPassword">
                        </label>

                        <div class="container-button">
                            <button type="submit" id="button_cadastro" onclick="cadastrarUsuario()">Cadastrar</button>
                        </div>

                    </div>

                </div>

                <div class="mostrar-usuario">
                    <div class="container-mostrar-usuario">
                        <div class="titulo-usuarios-inseridos">
                            <h3>Usuários Adicionados</h3>
                        </div>
                        <div id="usuarios_inseridos" class="usuarios-inseridos">
                        </div>
                    </div>
                </div>

            </div>

            <div class="alerta_erro">
                <div class="card_erro" id="cardErro">
                    <span id="mensagem_erro"></span>
                </div>
            </div>
            <div id="div_aguardar" class="loading-div">
                <!-- <img src="./assets/circle-loading.gif" id="loading-gif" /> -->
            </div>
    
            <div id="div_erros_login"></div>    

            <div id="div_alerta" class="div_alerta">

            </div>

        </div>

    </div>
</body>

</html>
<script src="../js/sessao.js"></script>
<script>

    kpis_silo1_geral()
    
    listaEmpresasCadastradas = [];
    
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    
    document.getElementById('visaoGeral').style.display = 'flex';
    //funcoes para aparecer e desaparecer cada div
    function mostrarGeral() {
        document.getElementById('visaoGeral').style.display = 'flex';
        document.getElementById('visaoIndividual').style.display = 'none';
        document.getElementById('validar_config').style.display = 'none'
        document.getElementById('visaoConfig').style.display = 'none';
        subTitulo.innerHTML = `Visão Geral`;
    }
    
    function mostrarIndividual() {
        document.getElementById('visaoGeral').style.display = 'none'
        document.getElementById('visaoIndividual').style.display = 'flex'
        document.getElementById('validar_config').style.display = 'none'
        document.getElementById('visaoConfig').style.display = 'none'
        subTitulo.innerHTML = `DashBoard Individual`;
    }

    function mostrarConfig() {
        document.getElementById('visaoGeral').style.display = 'none'
        document.getElementById('visaoIndividual').style.display = 'none'
        document.getElementById('validar_config').style.display = 'flex'
        document.getElementById('visaoConfig').style.display = 'none'
        subTitulo.innerHTML = `Configurações`;

    }

    function validar_codigo() {

        var idEmpresa = sessionStorage.ID_EMPRESA;
        var codigoVar = codigoValidarConfig_input.value;

        var codigo_validacao = 1234567

        if (codigoVar == codigo_validacao) {
            document.getElementById('visaoGeral').style.display = 'none'
            document.getElementById('visaoIndividual').style.display = 'none'
            document.getElementById('validar_config').style.display = 'none'
            document.getElementById('visaoConfig').style.display = 'flex'
            subTitulo.innerHTML = `Configurações`;
        } else {
            erro_validar_config.innerHTML = `Acesso negado. Código inválido`
        }
    }

    function listar() {
        fetch("/empresas/listar", {
            method: "GET",
        })
            .then(function (resposta) {
                resposta.json().then((empresas) => {
                    empresas.forEach((empresa) => {
                        listaEmpresasCadastradas.push(empresa);

                        console.log("listaEmpresasCadastradas")
                        console.log(listaEmpresasCadastradas[0].codigoAtivacao)
                    });
                });
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }

    function listarUsuario() {
        var idEmpresa = sessionStorage.ID_EMPRESA;

        fetch(`/usuarios/listarUsuario/${idEmpresa}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var conteudo = document.getElementById("usuarios_inseridos");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    conteudo.appendChild(mensagem);
                    throw "Nenhum resultado encontrado.";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var conteudo = document.getElementById("usuarios_inseridos");
                    conteudo.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var lista = resposta[i];

                        usuarios_inseridos.innerHTML += `<p>
                            Nome: ${lista.nome} | 
                            Email Pessoal: ${lista.email} | 
                            Telefone Comercial: ${lista.telComercial} | 
                            </p>`
                    }
                })
            }
        });
    };

    function cadastrarUsuario() {
        event.preventDefault();
        // aguardar();

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nomeVar = nome_input.value;
        var telUsuarioVar = telUsuario_input.value;
        var emailUsuarioVar = emailUsuario_input.value;
        var senhaVar = senha_input.value;
        var confirmacaoSenhaVar = confirmaSenha_input.value;
        var codigoVar = codigoAtivacaoUsuario_input.value;
        var naoMinusculo = senhaVar == senhaVar.toLowerCase();
        var naoMaiusculo = senhaVar == senhaVar.toUpperCase();
        var naoEspecial = !senhaVar.includes('@') && !senhaVar.includes('!') &&
            !senhaVar.includes('?') && !senhaVar.includes('#') &&
            !senhaVar.includes('$') && !senhaVar.includes('%') &&
            !senhaVar.includes('&') && !senhaVar.includes('*') &&
            !senhaVar.includes('.');
        var naoNumero = !senhaVar.includes('1') && !senhaVar.includes('2') &&
            !senhaVar.includes('2') && !senhaVar.includes('3') &&
            !senhaVar.includes('4') && !senhaVar.includes('5') &&
            !senhaVar.includes('6') && !senhaVar.includes('7') &&
            !senhaVar.includes('8') && !senhaVar.includes('9')
        !senhaVar.includes('0');
        // var idEmpresaVincular

        // Verificando se há algum campo em branco
        if (
            nomeVar == "" ||
            telUsuarioVar == "" ||
            emailUsuarioVar == "" ||
            senhaVar == "" ||
            confirmacaoSenhaVar == "" ||
            codigoVar == ""
        ) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "Preencha todos os campos.";

            setTimeout(sumirMensagem, 3000);
            finalizarAguardar();
            return false;
        } else if (nomeVar.length < 5) {
            cardErro.style.display = "block";
            // nome_input.style.border = "2px solid red"
            mensagem_erro.innerHTML =
                "Insira um nome válido.";

            setTimeout(sumirMensagem, 3000);
            finalizarAguardar();
            return false;
        } else if (telUsuarioVar.length < 10) {
            cardErro.style.display = "block";
            // cpf_input.style.border = "2px solid red"
            mensagem_erro.innerHTML =
                "Insira um telefone válido.";

            setTimeout(sumirMensagem, 3000);
            finalizarAguardar();
            return false;
        } else if (emailUsuarioVar.includes('@') == false) {
            cardErro.style.display = "block";
            // email_input.style.border = "2px solid red"
            mensagem_erro.innerHTML =
                "Insira um email válido.";

            setTimeout(sumirMensagem, 3000);
            finalizarAguardar();
            return false;
        } else if (senhaVar.length <= 8 || naoMaiusculo || naoMinusculo || naoEspecial || naoNumero) {
            cardErro.style.display = "block";
            // senha_input.style.border = "2px solid red"
            mensagem_erro.innerHTML =
                "A senha deve conter ao menos 8 caracteres, 1 número e 1 caractere especial, 1 letra maiúscula e 1 minúscula.";

            setTimeout(sumirMensagem, 3000);
            finalizarAguardar();
            return false;
        } else if (emailUsuarioVar.includes('@') == false || emailUsuarioVar.includes('.') == false) {
            cardErro.style.display = "block";
            // senha_input.style.border = "2px solid red"
            mensagem_erro.innerHTML =
                "Sua email deve conter arroba e ponto final.";

            setTimeout(sumirMensagem, 3000);
            finalizarAguardar();
            return false;
        } else if (confirmacaoSenhaVar != senhaVar) {
            cardErro.style.display = "block";
            // confirmacao_senha_input.style.boder = "2px solid red";
            // senha_input.style.border = "2px solid red";
            mensagem_erro.innerHTML =
                "As senhas não coincidem.";

            setTimeout(sumirMensagem, 3000);
            finalizarAguardar();
            return false;
        } else {
            usuarios_inseridos.innerHTML += `<p>
                            Nome: ${nomeVar} | 
                            Email Pessoal: ${emailUsuarioVar} | 
                            Telefone Comercial: ${telUsuarioVar} | 
                            </p>`
            setInterval(sumirMensagem, 3000);

        }

        // Verificando se o código de ativação é de alguma empresa cadastrada
        for (let i = 0; i < listaEmpresasCadastradas.length; i++) {
            if (listaEmpresasCadastradas[i].codigoAtivacao == codigoVar) {
                idEmpresaVincular = listaEmpresasCadastradas[i].idEmpresa
                console.log("Código de ativação válido.");
                break;
            } else {
                cardErro.style.display = "block";
                mensagem_erro.innerHTML = "Código de validação inválido.";
                finalizarAguardar();
            }
        }


        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                telUsuarioServer: telUsuarioVar,
                emailUsuarioServer: emailUsuarioVar,
                senhaServer: senhaVar,
                idEmpresaVincularServer: idEmpresaVincular
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    cardErro.style.display = "block";

                    mensagem_erro.innerHTML =
                        "Cadastro do usuário realizado com sucesso!";

                    // setTimeout(() => {
                    //     window.location = "login.html";
                    // }, "2000");

                    limparFormulario();
                    finalizarAguardar();
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                finalizarAguardar();
            });

        return false;
    }

    function sumirMensagem() {
        console.log("Função sumirMensagem chamada"); // Verificação de execução
        const cardErro = document.getElementById("cardErro");
        if (cardErro) {
            cardErro.style.display = "none";
        }
    }

    // function cadastrarUsuario() {
    //     var nomeVar = nome_input.value;
    //     var telUsuarioVar = telUsuario_input.value;
    //     var emailUsuarioVar = emailUsuario_input.value;
    //     var senhaVar = senha_input.value;
    //     var confirmacaoSenhaVar = confirmaSenha_input.value;
    //     var codigoVar = codigoAtivacaoUsuario_input.value;

    //     if (
    //         nomeVar == "" ||
    //         telUsuarioVar == "" ||
    //         emailUsuarioVar == "" ||
    //         senhaVar == "" ||
    //         confirmacaoSenhaVar == "" ||
    //         codigoVar == ""
    //     ) {
    //         alert("Preencha todos os campos!")
    //     } else {
    //         usuarios_inseridos.innerHTML += `<p>
    //                         Nome: ${nomeVar} | 
    //                         Email Pessoal: ${emailUsuarioVar} | 
    //                         Telefone Comercial: ${telUsuarioVar} | 
    //                         </p>`
    //     }
    // }

    // -------- FUNÇÕES DASH DINÂMICA --------------------------------------------------------------------------------------------------- //
    // GRÁFICO DE LINHA A CADA MEIA HORA (SILO 1 E SILO 2)
    function selecionarSilo() {
        const seletor = document.getElementById("select_silo");
        const siloId = seletor.value;
        atualizarPeriodicamente(siloId);

        kpis_silo1_ind()

        if (siloId == "#") {
            divMensagem.innerHTML = 'Escolha seu Silo'
            document.getElementById('escolha_silo').style.display = 'block'
            document.getElementById('dashboard-Silo1-ind').style.display = 'none'
            document.getElementById('dashboard-Silo2-ind').style.display = 'none'
        } else if (siloId == '1') {
            divMensagem.innerHTML = 'Silo 1 selecionado com sucesso!'
            document.getElementById('escolha_silo').style.display = 'none'
            document.getElementById('dashboard-Silo1-ind').style.display = 'block'
            document.getElementById('dashboard-Silo2-ind').style.display = 'none'
        } else if (siloId == '2') {
            divMensagem.innerHTML = 'Silo 2 selecionado com sucesso!'
            document.getElementById('escolha_silo').style.display = 'none'
            document.getElementById('dashboard-Silo1-ind').style.display = 'none'
            document.getElementById('dashboard-Silo2-ind').style.display = 'block'
        }
    }

    function atualizarPeriodicamente(siloId) {
        buscarDadosSilo1MeiaHora(siloId);
        buscarDadosSilo6horas(siloId);
        buscarDadosSiloSemana(siloId);
        buscarDadosSiloSemestral(siloId);

        setTimeout(() => {
            buscarDadosSilo1MeiaHora(siloId);
        }, 5000); // 30 minutos em milissegundos

        setTimeout(() => {
            buscarDadosSilo6horas(siloId);
        }, 21600000); // 6 horas em milissegundos

        setTimeout(() => {
            buscarDadosSiloSemana(siloId);
        }, 1.000 * 120 * 24 * 7); // 604.800.000 milhoes milissegundos - 7 dias

        setTimeout(() => {
            buscarDadosSiloSemestral(siloId);
        }, 15780096 * 1000); // 6 meses em milissegundos
    }

    function buscarDadosSilo6horas(siloId) {
        // Faz a requisição para a API
        fetch(`/dashboard/buscarMedidas6horas/${siloId}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (dados) {
                        console.log(`Dados recebidos para Silo ${siloId}: ${JSON.stringify(dados)}`);

                        dados.reverse();

                        plotarGrafico6horas(dados, siloId);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para Silo ${siloId}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para o gráfico do Silo ${siloId}: ${error.message}`);
            });
    }

    function kpis_silo1_ind() {
        var idEmpresa = sessionStorage.ID_EMPRESA
        var idSilo = 1
        fetch(`/dashboard/kpis_silo1/${idEmpresa}/${idSilo}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var conteudo = document.getElementById("porcentagem_silo1_ind");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    conteudo.appendChild(mensagem);
                    throw "Nenhum resultado encontrado.";
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    var conteudo = document.getElementById("porcentagem_silo1_ind");
                    conteudo.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var lista = resposta[i];
                        // // silo 1 individual
                        if (lista.porcentagemDetec < 4) {
                            porcentagem_silo1_ind.innerHTML = `<div id="statusSilo1_ok"></div>`
                        } else if (lista.porcentagemDetec < 9) {
                            porcentagem_silo1_ind.innerHTML = `<div id="statusSilo1_atencao"></div>`
                        } else if (lista.porcentagemDetec < 15) {
                            porcentagem_silo1_ind.innerHTML = `<div id="statusSilo1_alerta"></div>`
                        } else if (lista.porcentagemDetec > 15) {
                            porcentagem_silo1_ind.innerHTML = `<div id="statusSilo1_alerta"></div>`
                        }
                        porcentagem_silo1_ind.innerHTML = `<span id="silo1_porcentagem">${lista.porcentagemDetec}%</span>`
                    }
                })
            }
        });
    }

    function kpis_silo1_geral() {
        var idEmpresa = sessionStorage.ID_EMPRESA
        var idSilo = 1
        fetch(`/dashboard/kpis_silo1/${idEmpresa}/${idSilo}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var conteudo = document.getElementById("porcentagem_silo1_geral");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    conteudo.appendChild(mensagem);
                    throw "Nenhum resultado encontrado.";
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    var conteudo = document.getElementById("porcentagem_silo1_geral");
                    conteudo.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var lista = resposta[i];
                        if (lista.porcentagemDetec < 4) {
                            porcentagem_silo1_geral.innerHTML += `<div id="statusSilo1_ok"></div>`
                        } else if (lista.porcentagemDetec < 9) {
                            porcentagem_silo1_geral.innerHTML += `<div id="statusSilo1_atencao"></div>`
                        } else if (lista.porcentagemDetec < 15) {
                            porcentagem_silo1_geral.innerHTML += `<div id="statusSilo1_alerta"></div>`
                        } else if (lista.porcentagemDetec > 15) {
                            porcentagem_silo1_geral.innerHTML += `<div id="statusSilo1_alerta"></div>`
                        }
                        porcentagem_silo1_geral.innerHTML += `<span id="silo1_porcentagem">${lista.porcentagemDetec}%</span>`
                    }
                })
            }
        });
    }

    function kpis_silo2() {
        var idEmpresa = sessionStorage.ID_EMPRESA
        var idSilo = 2
        fetch(`/dashboard/kpis_silo2/${idEmpresa}/${idSilo}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var conteudo = document.getElementById("porcentagem_silo2_ind");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    conteudo.appendChild(mensagem);
                    throw "Nenhum resultado encontrado.";
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    var conteudo = document.getElementById("porcentagem_silo2_ind");
                    conteudo.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var lista = resposta[i];
                        // silo 2 individual
                        if (lista.porcentagemDetec < 4) {
                            porcentagem_silo2_ind.innerHTML += `<div id="statusSilo1_ok"></div>`
                        } else if (lista.porcentagemDetec < 9) {
                            porcentagem_silo2_ind.innerHTML += `<div id="statusSilo1_atencao"></div>`
                        } else if (lista.porcentagemDetec < 15) {
                            porcentagem_silo2_ind.innerHTML += `<div id="statusSilo1_alerta"></div>`
                        } else if (lista.porcentagemDetec > 15) {
                            porcentagem_silo2_ind.innerHTML += `<div id="statusSilo1_alerta"></div>`
                        }
                        // silo 2 geral
                        porcentagem_silo2_ind.innerHTML += `<span id="silo1_porcentagem">${lista.porcentagemDetec}%</span>`
                        if (lista.porcentagemDetec < 4) {
                            porcentagem_silo2_geral.innerHTML += `<div id="statusSilo1_ok"></div>`
                        } else if (lista.porcentagemDetec < 9) {
                            porcentagem_silo2_geral.innerHTML += `<div id="statusSilo1_atencao"></div>`
                        } else if (lista.porcentagemDetec < 15) {
                            porcentagem_silo2_geral.innerHTML += `<div id="statusSilo1_alerta"></div>`
                        }  else if (lista.porcentagemDetec > 15) {
                            porcentagem_silo2_geral.innerHTML += `<div id="statusSilo1_alerta"></div>`
                        }
                        porcentagem_silo2_geral.innerHTML += `<span id="silo1_porcentagem">${lista.porcentagemDetec}%</span>`
                    }
                })
            }
        });
    }

// ALERTA QUANDO MAIOR QUE 10% FEITO POR MIM GUILHERME TONINHO

    function alerta_silo1() {
        var idEmpresa = sessionStorage.ID_EMPRESA
        var idSilo = 1
        fetch(`/dashboard/kpis_silo1/${idEmpresa}/${idSilo}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var conteudo = document.getElementById("porcentagem_silo1_ind");
                    var mensagem = document.createElement("span");
                    console.log('Conteúdo')
                    throw "Nenhum resultado encontrado.";
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    var conteudo = document.getElementById("porcentagem_silo1_ind");
                    conteudo.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var lista = resposta[i];
                        // Alerta amarelo
                        if (lista.porcentagemDetec >= 5 && lista.porcentagemDetec < 10) {
                            div_alerta.innerHTML = `
                                            <div id="container_alerta" class="container_alerta_amarelo">
                                                <div id="mensagem_alerta" class="mensagem_alerta_amarelo">
                                                    <p>
                                                    O silo ${idSilo} está em estado de Atenção! (${lista.porcentagemDetec}%) Monitore e tome as devidas precauções para evitar o aumento de gás!
                                                    </p>
                                                </div>
                                            </div>
                                            `

                        } else if (lista.porcentagemDetec >= 10){ //Alerta Vermelho
                            
                            div_alerta.innerHTML = `
                                            <div id="container_alerta" class="container_alerta_vermelho">
                                                <div id="mensagem_alerta" class="mensagem_alerta_vermelho">
                                                    <p>
                                                    O silo ${idSilo} está em ALERTA! (${lista.porcentagemDetec}%) É de extrema urgência que você tome alguma ação preventiva!
                                                    </p>
                                                </div>
                                            </div>
                                            `

                        }
                    }
                })
            }
        });
    }

    function alerta_silo2() {
        var idEmpresa = sessionStorage.ID_EMPRESA
        var idSilo = 2
        fetch(`/dashboard/kpis_silo1/${idEmpresa}/${idSilo}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var conteudo = document.getElementById("porcentagem_silo1_ind");
                    var mensagem = document.createElement("span");
                    console.log('Conteúdo')
                    throw "Nenhum resultado encontrado.";
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    var conteudo = document.getElementById("porcentagem_silo1_ind");
                    conteudo.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var lista = resposta[i];
                        // Alerta amarelo
                        if (lista.porcentagemDetec >= 5 && lista.porcentagemDetec < 10) {
                            div_alerta.innerHTML = `
                                            <div id="container_alerta" class="container_alerta_amarelo">
                                                <div id="mensagem_alerta" class="mensagem_alerta_amarelo">

                                                    O silo ${idSilo} está em estado de Atenção! (${lista.porcentagemDetec}%) Monitore e tome as devidas precauções para evitar o aumento de gás!

                                                </div>
                                            </div>
                                            `

                        } else if (lista.porcentagemDetec >= 10){ //Alerta Vermelho
                            
                            div_alerta.innerHTML = `
                                            <div id="container_alerta" class="container_alerta_vermelho">
                                                <div id="mensagem_alerta" class="mensagem_alerta_vermelho">

                                                    O silo ${idSilo} está em ALERTA! (${lista.porcentagemDetec}%) É de extrema urgência que você tome alguma ação preventiva!

                                                </div>
                                            </div>
                                            `

                        }
                    }
                })
            }
        });
    }

// ^^ ALERTA QUANDO MAIOR QUE 10% FEITO POR MIM GUILHERME TONINHO


    function plotarGrafico6horas(dados, siloId) {
        const labels = dados.map(dado => dado.dataHora);
        const porcentagem = dados.map(dado => dado.porcentagem);

        const ctx = document.getElementById(`silo${siloId}_6horas`).getContext('2d');

        if (window[`graficoSilo6horas${siloId}`]) {
            window[`graficoSilo6horas${siloId}`].data.labels = labels;
            window[`graficoSilo6horas${siloId}`].data.datasets[0].data = porcentagem;
            window[`graficoSilo6horas${siloId}`].update();
        } else {
            window[`graficoSilo6horas${siloId}`] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Maior % diária a cada 6 horas`,
                        data: porcentagem,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: ''
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Porcentagem (%)'
                            },
                            beginAtZero: true
                            // suggestedMax: 15,
                        }
                    }
                }
            });
        }
    }


    function buscarDadosSilo1MeiaHora(siloId) {
        // Faz a requisição para a API
        fetch(`/dashboard/buscarMedidasMeiaHora/${siloId}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (dados) {
                        console.log(`Dados recebidos para Silo ${siloId}: ${JSON.stringify(dados)}`);

                        dados.reverse();

                        plotarGraficoMeiaHora(dados, siloId);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para Silo ${siloId}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para o gráfico do Silo ${siloId}: ${error.message}`);
            });
    }

    function plotarGraficoMeiaHora(dados, siloId) {
        const labels = dados.map(dado => dado.dataHora);
        const porcentagem = dados.map(dado => dado.porcentagem);

        const ctx = document.getElementById(`silo${siloId}_meiaHora`).getContext('2d');

        if (window[`graficoSiloMeiaHora${siloId}`]) {
            window[`graficoSiloMeiaHora${siloId}`].data.labels = labels;
            window[`graficoSiloMeiaHora${siloId}`].data.datasets[0].data = porcentagem;
            window[`graficoSiloMeiaHora${siloId}`].update();
        } else {
            window[`graficoSiloMeiaHora${siloId}`] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `% em tempo real de 30 em 30min`,
                        data: porcentagem,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: ''
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Porcentagem (%)'
                            },
                            beginAtZero: true,
                            suggestedMax: 15,
                        }
                    }
                }
            });
        }
    }

    function buscarDadosSiloSemana(siloId) {
        fetch(`/dashboard/buscarDadosSiloSemana/${siloId}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (dados) {
                        console.log(`Dados recebidos para Silo ${siloId}: ${JSON.stringify(dados)}`);

                        dados.reverse();

                        plotarGraficoSemana(dados, siloId);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para Silo ${siloId}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para o gráfico do Silo ${siloId}: ${error.message}`);
            });
    }

    function plotarGraficoSemana(dados, siloId) {
        const labels = dados.map(dado => dado.dataHora);
        const porcentagem = dados.map(dado => dado.porcentagem);

        const ctx = document.getElementById(`silo${siloId}_semana`).getContext('2d');

        if (window[`graficoSiloSemana${siloId}`]) {
            window[`graficoSiloSemana${siloId}`].data.labels = labels;
            window[`graficoSiloSemana${siloId}`].data.datasets[0].data = porcentagem;
            window[`graficoSiloSemana${siloId}`].update();
        } else {
            window[`graficoSiloSemana${siloId}`] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Maior % diária da última semana`,
                        data: porcentagem,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: ''
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Porcentagem (%)'
                            },
                            beginAtZero: true,
                            suggestedMax: 15,
                        }
                    }
                }
            });
        }
    }


    function buscarDadosSiloSemestral(siloId) {
        fetch(`/dashboard/buscarDadosSiloSemestral/${siloId}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (dados) {
                        console.log(`Dados recebidos para Silo ${siloId}: ${JSON.stringify(dados)}`);

                        dados.reverse();

                        plotarGraficoSemestral(dados, siloId);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para Silo ${siloId}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para o gráfico do Silo ${siloId}: ${error.message}`);
            });
    }

    function plotarGraficoSemestral(dados, siloId) {
        const labels = dados.map(dado => dado.dataHora);
        const porcentagem = dados.map(dado => dado.porcentagem);

        const ctx = document.getElementById(`silo${siloId}_semestre`).getContext('2d');

        if (window[`graficoSiloSemestral${siloId}`]) {
            window[`graficoSiloSemestral${siloId}`].data.labels = labels;
            window[`graficoSiloSemestral${siloId}`].data.datasets[0].data = porcentagem;
            window[`graficoSiloSemestral${siloId}`].update();
        } else {
            window[`graficoSiloSemestral${siloId}`] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Maior % mensal dos últimos semestre`,
                        data: porcentagem,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: ''
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Porcentagem (%)'
                            },
                            beginAtZero: true,
                            suggestedMax: 15,
                        }
                    }
                }
            });
        }
    }


</script>